# .travis.xml for use with EPICS Base ci-scripts
# (see: https://github.com/epics-base/ci-scripts)

language: cpp
compiler: gcc
dist: xenial

addons:
  apt:
    packages:
    - libreadline6-dev
    - libncurses5-dev
    - perl
    - clang
    - g++-mingw-w64-i686
    - qemu-system-x86

install:
  - ./.ci/travis-prepare.sh

script:
  - ./.ci/travis-build.sh

# If you need to do more during install and build,
# add a local directory to your module and do e.g.
#  - ./.ci-local/travis-install-extras.sh

# Define build jobs

matrix:
  include:

# Different configurations of default gcc and clang

  - env: BASE_BRANCH=7.0

  - env: BASE_BRANCH=7.0
    compiler: clang

  - env: BASE_BRANCH=7.0 EXTRA="CMD_CXXFLAGS=-std=c++11"

  - env: BASE_BRANCH=7.0 EXTRA="CMD_CXXFLAGS=-std=c++11"
    compiler: clang

# Trusty: compiler versions very close to RHEL 7

  - env: BASE_BRANCH=7.0
    dist: trusty

  - env: BASE_BRANCH=7.0 EXTRA="CMD_CXXFLAGS=-std=c++11"
    dist: trusty

# Cross-compilation to Windows using MinGW and WINE
    
  - env: BASE_BRANCH=7.0 WINE=32 TEST=NO STATIC=YES
    compiler: mingw

  - env: BASE_BRANCH=7.0 WINE=32 TEST=NO STATIC=NO
    compiler: mingw

# Cross-compilation to RTEMS

  - env: BASE_BRANCH=7.0 RTEMS=4.10 TEST=NO

  - env: BASE_BRANCH=7.0 RTEMS=4.9 TEST=NO

# Other gcc versions (adding as an extra package)

  - env: BASE_BRANCH=7.0
	compiler: gcc-6
	addons: { apt: { packages: ["g++-6"], sources: ["ubuntu-toolchain-r-test"] } }

  - env: BASE_BRANCH=7.0
	compiler: gcc-7
	addons: { apt: { packages: ["g++-7"], sources: ["ubuntu-toolchain-r-test"] } }

# MacOS build

  - env: BASE_BRANCH=7.0
    os: osx
    compiler: clang

# All above jobs can be defined for other branches of EPICS Base
# by setting BASE_BRANCH to the branch name, e.g. 3.15
